@using ADM.Models
@model CXC

@{
    var cxcs = ViewData["CXC"] as List<CXC>;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingreso de Proveedores</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="~/css/custom.css" rel="stylesheet" />
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- Tabla Paginar  -->
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</head>
<body>

    <div class="w-full">
    </div>
    <!--                  Inicio Form                        -->
    <form id="filterForm">
        <div class="bg-gray-800 text-white p-5 rounded-lg shadow-lg">
            <h2 class="text-lg font-bold mb-4">Información Cuentas Por Cobrar</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-6">
                <!-- Fecha Inicio -->
                <div class="sm:col-span-1">
                    <label for="entry_date" class="block text-sm font-medium leading-6 text-white">Fecha Inicio</label>
                    <div class="mt-2">
                        <input type="date" id="entry_date" name="entry_date" class="block w-full rounded-md bg-gray-700 border-0 py-1.5 text-white focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" style="padding-left: 10px;">
                    </div>
                </div>
                <!-- Fecha Final -->
                <div class="sm:col-span-1">
                    <label for="expiry_date" class="block text-sm font-medium leading-6 text-white">Fecha Final</label>
                    <div class="mt-2">
                        <input type="date" id="expiry_date" name="expiry_date" class="block w-full rounded-md bg-gray-700 border-0 py-1.5 text-white focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" style="padding-left: 10px;">
                    </div>
                </div>
               @*  <!-- Estado -->
                <div class="sm:col-span-1">
                    <label for="estado" class="block text-sm font-medium leading-6 text-white">Estado</label>
                    <div class="mt-2">
                        <select id="estado" name="estado" class="block w-full rounded-md bg-gray-700 border-0 py-1.5 text-white focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" style="padding-left: 10px; height: 38px;">
                            <option value="">Seleccione un estado</option>
                            <option value="completado">Completado</option>
                            <option value="pendiente">Pendiente</option>
                        </select>
                    </div>
                </div>
                <!-- Proveedor -->
                <div class="sm:col-span-1">
                    <label for="FK_Cliente" class="block text-sm font-medium leading-6 text-white">Cliente</label>
                    <div class="mt-2">
                        <select id="FK_Cliente" class="block w-full rounded-md bg-gray-700 border-0 py-1.5 text-white focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" style="padding-left: 10px; height: 38px;">
                            <option value="">Seleccione un Cliente</option>
                            @* Aquí puedes agregar opciones dinámicamente 
                        </select>
                    </div>
                </div> *@
                <!-- Número de Documento -->
                <div class="sm:col-span-1">
                    <label for="document_number" class="block text-sm font-medium leading-6 text-white">Número de Documento</label>
                    <div class="mt-2">
                        <input type="text" id="document_number" name="document_number" class="block w-full rounded-md bg-gray-700 border-0 py-1.5 text-white focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6" style="padding-left: 10px;">
                    </div>
                </div>
            </div>
        </div>
    </form>

    <br>
    <br>

    <!--                  Final Form                        -->
    <!--                  Inicio de Tabla                        -->

    <div class="w-full mt-8 bg-gray-800 p-6 rounded-lg shadow-lg" >
        <div class="flex justify-between items-center bg-gray-800 text-white p-4 rounded-t-lg">
            <h3 class="text-xl font-semibold"><i class="fas fa-list mr-3"></i> Listado de Cuentas por Cobrar</h3>
        </div>

        <div class="overflow-auto mt-4">
            <table id="tablaCXC" class="min-w-full bg-gray-800 text-white">
                <thead class="bg-gray-900">
                    <tr>
                        <th class="py-3 px-4 text-center">Documento</th>
                        <th class="py-3 px-4 text-center">Cliente</th>
                        <th class="py-3 px-4 text-center">Fecha Emisión</th>
                        <th class="py-3 px-4 text-center">Fecha Vence</th>
                        <th class="py-3 px-4 text-center">Total</th>
                        <th class="py-3 px-4 text-center">Saldo</th>
                        <th class="py-3 px-4 text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="bodyTablaCXC" class="text-center">
                    @if (cxcs != null)
                    {
                        @foreach (var cxc in cxcs)
                        {
                            <tr class="even:bg-gray-700 hover:bg-gray-600">
                                <td class="py-3 px-4 border-b border-gray-700">@Html.DisplayFor(modelItem => cxc.PK_Documento_CC)</td>
                                <td class="py-3 px-4 border-b border-gray-700">@Html.DisplayFor(modelItem => cxc.NombreCliente)</td>
                                <td class="py-3 px-4 border-b border-gray-700">@Html.Raw(cxc.Fecha_Documento.ToString("dd/MM/yyyy"))</td>
                                <td class="py-3 px-4 border-b border-gray-700 fecha-vencimiento">@Html.Raw(cxc.Fecha_Vencimiento.ToString("yyyy-MM-dd"))</td>
                                <td class="py-3 px-4 border-b border-gray-700">@Html.DisplayFor(modelItem => cxc.Total_XC)</td>
                                <td class="py-3 px-4 border-b border-gray-700">@Html.DisplayFor(modelItem => cxc.Saldo_Pendiente)</td>
                                <td>
                                    <div class="py-3 px-4 border-b border-gray-700 flex justify-center space-x-2">
                                        <a asp-action="Abono" asp-route-PK="@cxc.PK_Documento_CC" class="btn btnCrear" title="Crear Abono">
                                            <svg class="svg-inline--fa fa-times fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" /></svg>
                                        </a>
                                        <a asp-action="Detalles" asp-route-PK="@cxc.PK_Documento_CC" class="btn VerDetalles" title="Detalles">
                                            <svg class="svg-inline--fa fa-eye fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="eye" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-70.7 0-128-57.31-128-128s57.31-128 128-128 128 57.31 128 128-57.3 128-128 128zm0-216a88 88 0 1 0 88 88 88 88 0 0 0-88-88z"></path></svg>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="14">No hay datos disponibles.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!--                  Final Tabla                        -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            document.getElementById('filterForm').addEventListener('input', filterTable);

            function filterTable() {
                var fechaInicio = document.getElementById('entry_date').value;
                var fechaFinal = document.getElementById('expiry_date').value;
                var estado = document.getElementById('estado').value.toLowerCase();
                var cliente = document.getElementById('FK_Cliente').value.toLowerCase();
                var numeroDocumento = document.getElementById('document_number').value.toLowerCase();

                var table = document.getElementById('tablaCXC');
                var rows = table.getElementsByTagName('tr');

                for (var i = 1; i < rows.length; i++) {
                    var row = rows[i];
                    var fecha = row.cells[2].textContent.trim();
                    var estadoRow = row.cells[5].textContent.toLowerCase();
                    var proveedorRow = row.cells[1].textContent.toLowerCase();
                    var numeroDocumentoRow = row.cells[0].textContent.toLowerCase();

                    var mostrar = true;

                    if (fechaInicio && fechaFinal) {
                        var fechaInicioDate = new Date(fechaInicio);
                        var fechaFinalDate = new Date(fechaFinal);
                        var fechaRowDate = new Date(fecha);

                        if (fechaRowDate < fechaInicioDate || fechaRowDate > fechaFinalDate) {
                            mostrar = false;
                        }
                    }

                    if (estado && estadoRow.indexOf(estado) === -1) {
                        mostrar = false;
                    }

                    if (cliente && proveedorRow.indexOf(cliente) === -1) {
                        mostrar = false;
                    }

                    if (numeroDocumento && numeroDocumentoRow.indexOf(numeroDocumento) === -1) {
                        mostrar = false;
                    }

                    if (mostrar) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            }


            // //Funcion para paginar en index
            //      $(document).ready(function () {
            //          $('#tablaCXC').DataTable({
            //              "paging": true,
            //              "pagingType": "simple_numbers",
            //              "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
            //              "searching": false,
            //              "language": {
            //                  "lengthMenu": " Mostrar _MENU_ registros por página",
            //                  "zeroRecords": "No se encontraron resultados",
            //                  "info": " Mostrando página _PAGE_ de _PAGES_",
            //                  "infoEmpty": "No hay registros disponibles",
            //                  "infoFiltered": "(filtrado de _MAX_ registros totales)",
            //                  "paginate": {
            //                      "first": "Primero",
            //                      "last": "Último",
            //                      "next": "Siguiente",
            //                      "previous": "Anterior"
            //                  }
            //              }
            //          });
            //      });


            document.addEventListener("DOMContentLoaded", function () {
                const fechaActual = new Date();
                const celdasFechaVence = document.querySelectorAll('.fecha-vencimiento');

                celdasFechaVence.forEach(celda => {
                    const fechaVence = new Date(celda.textContent.trim());
                    const diffTime = fechaVence - fechaActual;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (diffDays < 0) {
                        celda.style.color = 'red';
                    } else if (diffDays < 7) {
                        celda.style.color = 'yellow';
                    } else if (diffDays > 15) {
                        celda.style.color = 'green';
                    }
                });
            });
        </script>
</body>
</html>